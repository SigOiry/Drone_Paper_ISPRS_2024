---
title: "PREPRINT -- Exploring diverse Applications of Drone Technology: From Active to Passive  Remote Sensing  -- PREPRINT."
author:
  - name: Simon Oiry
    orcid: 0000-0001-7161-5246
    corresponding: true
    email: oirysimon@gmail.com
    roles:
      - Investigation
      - Writing
      - Data acquisition
    affiliations:
      - Institut des Substances et Organismes de la Mer, ISOMer, Nantes Université, UR 2160, F-44000 Nantes, France
  - name: Philippe Rosa
    corresponding: false
    roles: 
      - Data acquisition
      - Revision
    affiliations:
      - Institut des Substances et Organismes de la Mer, ISOMer, Nantes Université, UR 2160, F-44000 Nantes, France
  - name: Laurent Barillé
    corresponding: false
    roles: 
      - Investigation
      - Data acquisition
      - Revision
    affiliations:
      - Institut des Substances et Organismes de la Mer, ISOMer, Nantes Université, UR 2160, F-44000 Nantes, France
keywords:
  - Drone
  - Remote Sensing
  - Coastal Ecosystems
  - Archeology
  - LiDAR
abstract: |
  coucou
plain-language-summary: 
key-points:
  - A review of drone technologies applied to coastal ecology, 
date: last-modified
citation:
  container-title: Journal of photogrammetry and Remote Sensing
number-sections: true
notebook-links: false
editor_options: 
  chunk_output_type: console
csl: RSE.csl
---

```{r library}
#| cache: false
#| echo: false
#| warning: false
#| eval: true

library(terra)
library(sf) 
library(rnaturalearth) 
library(rnaturalearthdata) 
library(rnaturalearthhires)
library(tidyverse)
library(Utilities.Package)

```

```{r my_comma}
#| cache: false
#| echo: false
#| warning: false

my_comma<-scales::label_comma(accuracy = NULL, big.mark = ",",decimal.mark = ".")
```



## Site study

```{r Figure1 Overall Map}
#| cache: true
#| echo: false
#| eval: false
#| warning: false

world_map <- sovereignty10 %>% 
  st_as_sf()

bbox_europe <- st_bbox(c(xmin = -20, ymin = 34,
                         xmax = 30, ymax = 55) ,
                       crs = st_crs(world_map)) 

world_map<-st_make_valid(world_map) 

european_union_country <- st_crop(world_map, bbox_europe)  %>% 
  st_transform("+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs ") %>% 
  dplyr::pull(unique(SOVEREIGNT))


european_union_map_cropped <- sovereignty10 %>% 
  st_as_sf() %>% 
  dplyr::filter(SOVEREIGNT %in% european_union_country)

Projects<-data.frame(
  Name=c(
  "Spain - Guadalquivir River",
  "Spain - Baiona",
  "France - Noirmoutier Island",
  "Greece - Cape Tainaron"),
  Long=c(-6.23104,
         -8.86272, 
         -2.16741,
         22.486823) ,
  Lat=c(36.8947, 
        42.120795,
        46.9076,
        36.401765) 
  )  %>% 
  st_as_sf(coords=c("Long","Lat") )  %>% 
  st_set_crs("EPSG:4326")  %>% 
  st_transform("+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs ")  

Projects_df<-Projects %>%
  dplyr::mutate(lon = sf::st_coordinates(.) [,1],
                lat = sf::st_coordinates(.) [,2]) %>% 
  sf::st_set_geometry(NULL)  %>% 
  tidyr::separate(Name, into=c("Country","Site") ,sep=" - ")  %>% 
  dplyr::mutate(Country=as.factor(Country) ,
                Site=as.factor(Site) ) 

sf_use_s2(FALSE)

bbox_EU <- st_bbox(c(xmin = -30, ymin = 20,
                         xmax = 50, ymax = 70) ,
                       crs = st_crs(european_union_map_cropped) ) 

  MiniEU_map<-st_crop(european_union_map_cropped, bbox_EU)  %>% 
  st_transform("+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs ")  

  df_P1<-Projects_df %>% 
    dplyr::mutate(ID = c(1:nrow(.)),
           ID = case_when(ID == 1 ~ "C",
                          ID == 2 ~ "B",
                          ID == 3 ~ "A",
                          TRUE ~ "D")) %>% 
    dplyr::select(c(lon,lat,ID,Site))
    
    scaleFUN <- function(x) paste0(sprintf("%.2f", x),"°N")
  

p1 <-
  ggplot(MiniEU_map) +
  geom_sf(linewidth=0.5,alpha=0.93,
          fill="#CFCFCF",colour="grey30")+
  coord_sf(xlim=c(2600000,5600000) ,
          ylim=c(1600000,3100000))+
    ggforce::geom_mark_ellipse(data=df_P1,
                 aes(x=lon,
                     y=lat,
                     label = ID,
                     description=Site) ,
                 linewidth=0.3,
                 fill="goldenrod",
                 show.legend=F,
                 label.hjust = 0.5,
                 con.size = 2,
                 con.colour = "goldenrod4",
                 label.fontsize = c(25,20),
                 alpha=0.8,
  expand = unit(2, "mm") , 
  radius = unit(2, "mm") , 
  label.buffer = unit(5, "mm") ,
  label.fill = "grey90")+

  theme_Bede_Map()+
  labs(x="Longitude",
       y="Latitude")+
  scale_y_continuous(labels=scaleFUN)+
  theme(plot.margin = unit(c(0.1,0.1,0.1,0.1), "cm"),
        axis.title = element_blank(),
        axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20) )



ggsave("Figures/High_res/Figure1/Map_Study_Site.png",p1,width= 10, height=10)  


```

```{r Figure1 Noirmoutier}
#| cache: true
#| echo: false
#| eval: false
#| warning: false


masks_Noirmoutier <- "Data/shp/Figure1/Noirmoutier_masks_32630.shp"%>% 
  read_sf()

Flight_Noirmoutier <- "Data/shp/Figure1/Noirmoutier_flight_area_32630.shp"%>% 
  read_sf()

Flight_label<-data.frame(
  Name=c(
  "Polycheate reef") ,
  Description = c("Multispectral and LiDAR mapping"),
  Long=c(-2.17503) ,
  Lat=c(46.90546) 
  )  %>% 
  st_as_sf(coords=c("Long","Lat") )  %>% 
  st_set_crs("EPSG:4326")  %>% 
  st_transform(crs(masks_Noirmoutier))  %>% 
  dplyr::mutate(lon = sf::st_coordinates(.) [,1],
                lat = sf::st_coordinates(.) [,2]) %>% 
  sf::st_set_geometry(NULL)

plot_label_Noirmoutier <- data.frame(x = -2.3,
                         y = 47.04) %>% 
  st_as_sf(coords=c("x","y")) %>% 
  st_set_crs("EPSG:4326")  %>% 
  st_transform(crs(masks_Noirmoutier)) %>% 
  st_coordinates()

Noirmoutier_plot <-
ggplot() +
  scale_fill_manual("", labels = c("Flight area","Intertidal area", "Land area"),
                    values = c("darkred","#7DC27D", "#CFCFCF"))+
  geom_sf(data = masks_Noirmoutier, mapping = aes(fill = Type),linewidth=0.05,alpha=0.93,colour="grey30")+
  geom_sf(data = Flight_Noirmoutier, mapping = aes(fill = Type),linewidth=0.05,alpha=0.93)+
      coord_sf(xlim=c(551000,569800),
               ylim=c(5191700,16800+5193700))+
  ggforce::geom_mark_ellipse(data=Flight_label,
                 aes(x=lon,
                     y=lat,
                     label = Name,
                     group = Name),
                     # description=Description),
                 size=0.3,
                 fill = "goldenrod",
                 con.colour = "goldenrod4",
                 show.legend=F,
                 label.fontsize = 25,
                 label.hjust = 0.5,
                 con.size = 2,
                 alpha=0.8,
  expand = unit(2, "mm") , 
  radius = unit(2, "mm") ,
  label.fill = "grey90",
  label.buffer = unit(5, "mm")) +
    # theme_void()+
  theme_Bede_Map()+
  labs(x="Longitude",
       y="Latitude")+
  geom_label(aes(x = plot_label_Noirmoutier[1], y = plot_label_Noirmoutier[2], label = "A"), size = 20)+
  scale_x_continuous(breaks = seq(-2.30, -2.0, by = 0.10))+
  theme(plot.margin = unit(c(0.1,0.1,0.1,0.1), "cm") ,
        legend.position = "none",
        axis.title = element_blank(),
        axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20))


ggsave("Figures/High_res/Figure1/Map_Noirmoutier.png",Noirmoutier_plot,width= 10, height=10)  


```

```{r Figure1 Vigo}
#| cache: true
#| echo: false
#| eval: false
#| warning: false


masks_Vigo <- "Data/shp/Figure1/Vigo_masks_32629.shp"%>% 
  read_sf()

Flight_Vigo <- "Data/shp/Figure1/Vigo_flight_area_32629.shp"%>% 
  read_sf()

Flight_label_Vigo<-data.frame(
  Name=c(
  "Goose barnacle mapping") ,
  Description = c("Multispectral and LiDAR mapping"),
  Long=c(-8.862174) ,
  Lat=c(42.121263) 
  )  %>% 
  st_as_sf(coords=c("Long","Lat") )  %>% 
  st_set_crs("EPSG:4326")  %>% 
  st_transform(crs(masks_Vigo))  %>% 
  dplyr::mutate(lon = sf::st_coordinates(.) [,1],
                lat = sf::st_coordinates(.) [,2]) %>% 
  sf::st_set_geometry(NULL)

plot_label_Vigo <- data.frame(x = -8.875,
                         y = 42.145) %>% 
  st_as_sf(coords=c("x","y")) %>% 
  st_set_crs("EPSG:4326")  %>% 
  st_transform(crs(masks_Noirmoutier)) %>% 
  st_coordinates()

Vigo_plot <- ggplot() +
  scale_fill_manual("", labels = c("Flight area","Intertidal area", "Land area"),
                    values = c("darkred","#7DC27D", "#CFCFCF"))+
  geom_sf(data = masks_Vigo, mapping = aes(fill = Type),linewidth=0.05,alpha=0.93,colour="grey30")+
  geom_sf(data = Flight_Vigo, mapping = aes(fill = Type),linewidth=0.05,alpha=0.93)+
      coord_sf(xlim=c(509877,514679),
               ylim=c(4661398, 4661398 + 4802))+
  ggforce::geom_mark_ellipse(data=Flight_label_Vigo,
                 aes(x=lon,
                     y=lat,
                     label = Name,
                     group = Name),
                     # description=Description),
                 size=0.3,
                 fill = "goldenrod",
                 con.colour = "goldenrod4",
                 show.legend=F,
                 label.fontsize = 25,
                 label.hjust = 0.5,
                 con.size = 2,
                 alpha=0.8,
  expand = unit(2, "mm") , 
  radius = unit(2, "mm") ,
  label.fill = "grey90",
  label.buffer = unit(5, "mm")) +
    # theme_void()+
  theme_Bede_Map()+
  labs(x="Longitude",
       y="Latitude")+
  geom_label(aes(x = plot_label_Vigo[1], y = plot_label_Vigo[2], label = "B"), size = 20)+
  scale_x_continuous(breaks = seq(-8.9, -8.80, by = 0.02))+
  theme(plot.margin = unit(c(0.1,0.1,0.1,0.1), "cm") ,
        legend.position = "none",
        axis.title = element_blank(),
        axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20))


ggsave("Figures/High_res/Figure1/Map_Vigo.png",Vigo_plot,width= 10, height=10)  


```

```{r Figure1 Cadiz}
#| cache: true
#| echo: false
#| eval: false
#| warning: false


masks_Cadiz <- "Data/shp/Figure1/Cadiz_masks_32629.shp"%>% 
  read_sf()


Flight_label_Cadiz<-data.frame(
  Name=c(
  "La Esparraguera - Tarfia") ,
  Description = c("Microphytobenthos mapping"),
  Long=c(-6.231733) ,
  Lat=c(36.894668) 
  )  %>% 
  st_as_sf(coords=c("Long","Lat") )  %>% 
  st_set_crs("EPSG:4326")  %>% 
  st_transform(crs(masks_Cadiz))  %>% 
  dplyr::mutate(lon = sf::st_coordinates(.) [,1],
                lat = sf::st_coordinates(.) [,2]) %>% 
  sf::st_set_geometry(NULL)

plot_label_Cadiz <- data.frame(x = -8.875,
                         y = 42.145) %>% 
  st_as_sf(coords=c("x","y")) %>% 
  st_set_crs("EPSG:4326")  %>% 
  st_transform(crs(masks_Noirmoutier)) %>% 
  st_coordinates()

Cadiz_plot <- ggplot() +
  scale_fill_manual("", labels = c("Intertidal area", "Land area"),
                    values = c("#7DC27D", "#CFCFCF"))+
  geom_sf(data = masks_Cadiz, mapping = aes(fill = Type),linewidth=0.05,alpha=0.93,colour="grey30")+
  # geom_sf(data = Flight_Vigo, mapping = aes(fill = Type),linewidth=0.05,alpha=0.93)+
      coord_sf(xlim=c(691004,774599),
               ylim=c(4033353, 4033353 + 83595))+
  ggforce::geom_mark_ellipse(data=Flight_label_Vigo,
                 aes(x=lon,
                     y=lat,
                     label = Name,
                     group = Name),
                     # description=Description),
                 size=0.3,
                 fill = "goldenrod",
                 con.colour = "goldenrod4",
                 show.legend=F,
                 label.fontsize = 25,
                 label.hjust = 0.5,
                 con.size = 2,
                 alpha=0.8,
  expand = unit(2, "mm") , 
  radius = unit(2, "mm") ,
  label.fill = "grey90",
  label.buffer = unit(5, "mm")) +
    # theme_void()+
  theme_Bede_Map()+
  labs(x="Longitude",
       y="Latitude")+
  geom_label(aes(x = plot_label_Vigo[1], y = plot_label_Vigo[2], label = "B"), size = 20)+
  scale_x_continuous(breaks = seq(-8.9, -8.80, by = 0.02))+
  theme(plot.margin = unit(c(0.1,0.1,0.1,0.1), "cm") ,
        legend.position = "none",
        axis.title = element_blank(),
        axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20))


ggsave("Figures/High_res/Figure1/Map_Vigo.png",Vigo_plot,width= 10, height=10)  


```

```{r Figure1 saving}
#| cache: false
#| echo: false
#| eval: false
#| warning: false

layout <- c(
  patchwork::area(t = 1, l = 1, b = 10, r = 10),
  patchwork::area(t = 1, l = 11, b = 10, r = 20),
  patchwork::area(t = 11, l = 1, b = 20, r = 10),
  patchwork::area(t = 11, l = 11, b = 20, r = 20)
)
# plot(layout)

Tot <- magick::image_ggplot(magick::image_read("Figures/High_res/Figure1/Map_Drone_Sites.png"), interpolate = T)
BB <- magick::image_ggplot(magick::image_read("Figures/High_res/Figure1/Map_BB.png"), interpolate = T)
Mor <- magick::image_ggplot(magick::image_read("Figures/High_res/Figure1/Map_Morbihan.png"), interpolate = T)
Av <- magick::image_ggplot(magick::image_read("Figures/High_res/Figure1/Map_Aveiro.png"), interpolate = T)


a<-Tot+Mor+BB+Av+patchwork::plot_layout(design=layout)

ggsave("./Figures/High_res/Figure1/Fig1_Map_Drone_Sites.png",a, width= 10, height=10, dpi = 800)
```

```{r Figure1}
#| cache: false
#| echo: false
#| warning: false
#| fig-cap: >
#|   Location of drone flights in France and Portugal. A: Gulf of Morbihan (Two sites), B: Bourngeuf Bay (Two sites), C: Ria de Aveiro Coastal Lagoon (Three sites). Green represents intertidal areas. 
#| label: fig-map
#| out-width: "100%"

knitr::include_graphics("./Figures/Low_res/Fig1_Map_Drone_Sites.png")
```


